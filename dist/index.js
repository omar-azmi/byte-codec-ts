var y=(...e)=>{let r=[0];for(let t of e)r.push(r[r.length-1]+t.length);let n=new Uint8Array(r.pop());for(let t of e)n.set(t,r.shift());return n},f=()=>new Uint8Array(Uint32Array.of(1).buffer)[0]===1;var A=(e,r)=>{let n=e.byteLength,t=new Uint8Array(n),a=r;for(let c=0;c<a;c++){let i=a-1-c*2;for(let o=c;o<n+c;o+=a)t[o]=e[o+i]}return t};var T=new TextEncoder,N=new TextDecoder,u=f(),F=(e,r,n,...t)=>{let[a,c]=p(n,e,r,...t);return[a,r+c]},E=(e,r,n,t,...a)=>{let c=m(n,t,...a);return e.set(c,r),[e,r+c.length]},P=(...e)=>{let r=[];for(let n of e)r.push(m(...n));return y(...r)},J=(e,r,...n)=>{let t=[],a=0;for(let[c,...i]of n){let[o,s]=p(c,e,r+a,...i);t.push(o),a+=s}return[t,a]},m=(e,r,...n)=>{switch(e){case"bool":return w(r);case"cstr":return C(r);case"str":return z(r);case"bytes":return D(r);default:return e.endsWith("[]")?R(r,e):K(r,e)}},p=(e,r,n,...t)=>{switch(e){case"bool":return I(r,n);case"cstr":return $(r,n);case"str":return k(r,n,...t);case"bytes":return B(r,n,...t);default:return e.endsWith("[]")?G(r,n,e,...t):W(r,n,e)}},w=e=>Uint8Array.of(e?1:0),I=(e,r=0)=>[e[r]>=1,1],C=e=>T.encode(e+"\0"),$=(e,r=0)=>{let n=e.indexOf(0,r),t=e.subarray(r,n);return[N.decode(t),t.length+1]},z=e=>T.encode(e),k=(e,r=0,n)=>{let t=n===void 0?void 0:r+n,a=e.subarray(r,t);return[N.decode(a),a.length]},D=e=>e,B=(e,r=0,n)=>{let t=n===void 0?void 0:r+n,a=e.slice(r,t);return[a,a.length]},l=e=>{if(e[2]==="c")return Uint8ClampedArray;switch(e=e[0]+e[1],e){case"u1":return Uint8Array;case"u2":return Uint16Array;case"u4":return Uint32Array;case"u8":return BigUint64Array;case"i1":return Int8Array;case"i2":return Int16Array;case"i4":return Int32Array;case"i8":return BigInt64Array;case"f4":return Float32Array;case"f8":return Float64Array;default:return Error('an unrecognized typed array type `"${type}"` was provided'),Uint8Array}},R=(e,r)=>{let n=l(r),[t,a,c]=r,i=parseInt(a),o=!!(c==="l"&&u||c==="b"&&!u||i===1),s=n.from(e);if(s instanceof Uint8Array)return s;let d=new Uint8Array(s.buffer);return o?d:A(d,i)},G=(e,r=0,n,t)=>{let[a,c,i]=n,o=parseInt(c),s=!!(i==="l"&&u||i==="b"&&!u||o===1),d=t?o*t:void 0,h=e.slice(r,d?r+d:void 0),g=h.length,v=l(n),U=new v(s?h.buffer:A(h,o).buffer);return[Array.from(U),g]},K=(e,r)=>{let[n,t,a]=r;if(t==="v")return n==="u"?L(e):O(e);let c=l(n+t+(a||"")),i=parseInt(t),o=!!(a==="l"&&u||a==="b"&&!u||i===1),s=c.of(e);return o||s.reverse(),new Uint8Array(s.buffer)},W=(e,r=0,n)=>{let[t,a,c]=n;if(a==="v")return t==="u"?q(e,r):j(e,r);let i=l(t+a+(c||"")),o=parseInt(a),s=!!(c==="l"&&u||c==="b"&&!u||o===1),d=e.slice(r,r+o);return s||d.reverse(),[Number(new i(d.buffer)[0]),o]},L=e=>{e=BigInt(e)*(e>=0?1n:-1n);let r=[];do r.push(Number((e&0b01111111n)+0b10000000n)),e>>=7n;while(e>0n);return r[0]&=127,Uint8Array.from(r.reverse())},q=(e,r=0)=>{let n=r,t,a=0n;do t=e[r++],a<<=7n,a+=BigInt(t&127);while(t>>7==1);return[Number(a),r-n]},O=e=>{let r=e>=0?1n:-1n,n=[];for(e=BigInt(e)*r;e>0b00111111n;)n.push(Number((e&0b01111111n)+0b10000000n)),e>>=7n;return n.push(Number(e&0b00111111n|(r==-1n?0b11000000n:0b10000000n))),n[0]&=127,Uint8Array.from(n.reverse())},j=(e,r=0)=>{let n=r,t=e[r++],a=(t&64)>0n?-1n:1n,c=BigInt(t&63);for(;t>>7==1;)t=e[r++],c<<=7n,c+=BigInt(t&127);return c*=a,[Number(c),r-n]},M={encode:m,decode:p,encodeSeq:P,decodeSeq:J,writeTo:E,readFrom:F};var b=(e,r)=>{switch(r=r||e.value,e.type){case"record":return Y(e,r);case"tuple":return Q(e,r);case"array":return X(e,r);case"callback":return _(e,r);case"ecallback":return _(e,r);case"dcallback":return new Uint8Array(0);default:return m(e.type,r,...e.args===void 0?[]:e.args)}},S=(e,r,n)=>{switch(e.type){case"record":return H(e,r,n);case"tuple":return V(e,r,n);case"array":return Z(e,r,n);case"callback":return x(e,r,n);case"ecallback":return[void 0,0];case"dcallback":return x(e,r,n);default:return p(e.type,r,n,...e.args===void 0?[]:e.args)}},_=(e,r)=>{let[n,...t]=e.args;return n(...t)||new Uint8Array(0)},x=(e,r,n)=>{let[t,...a]=e.args,[c,i]=t(...a);return[c||void 0,i||0]},Y=(e,r)=>{let n=[];for(let t of e.children)n.push(b(t,r[t.name]));return y(...n)},H=(e,r,n)=>{let t={},a=0;for(let c of e.children){let[i,o]=S(c,r,n+a);a+=o,t[c.name]=i}return[t,a]},Q=(e,r)=>{let n=[],t=e.children,a=t.length;for(let c=0;c<a;c++)n.push(b(t[c],r[c]));return y(...n)},V=(e,r,n)=>{let t=[],a=e.children,c=a.length,i=0;for(let o=0;o<c;o++){let[s,d]=S(a[o],r,n+i);i+=d,t.push(s)}return[t,i]},X=(e,r)=>{let n=[],t=e.children[0],a=r.length;for(let c=0;c<a;c++)n.push(b(t,r[c]));return y(...n)},Z=(e,r,n)=>{let t=[],a=e.children[0],c=e.args[0],i=0;for(let o=0;o<c;o++){let[s,d]=S(a,r,n+i);i+=d,t.push(s)}return[t,i]};export{S as decodeS,M as default,b as encodeS};
