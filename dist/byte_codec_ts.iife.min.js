"use strict";(()=>{var B=Object.defineProperty;var $=(t,e,r)=>e in t?B(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var C=(t,e,r)=>($(t,typeof e!="symbol"?e+"":e,r),r);var U=(t,e)=>x([t],e),x=(t,e)=>e[0]==="u"?G(t):W(t),D=(t,e,r)=>{let[n,a]=v(t,e,r,1);return[n[0],a]},v=(t,e,r,n)=>r[0]==="u"?L(t,e,n):M(t,e,n),G=t=>{let e=t.length,r=[];for(let n=0;n<e;n++){let a=t[n];a=a*(a>=0?1:-1);let c=[];do c.push((a&127)+128),a>>=7;while(a>0);c[0]&=127,r.push(...c.reverse())}return Uint8Array.from(r)},L=(t,e=0,r)=>{r===void 0&&(r=1/0);let n=[],a=e,c=t.length,i=0;for(let s=t[e++];r>0&&e<c+1;s=t[e++])i<<=7,i+=s&127,s>>7===0&&(n.push(i),r--,i=0);return e--,[n,e-a]},W=t=>{let e=t.length,r=[];for(let n=0;n<e;n++){let a=t[n],c=a>=0?1:-1,i=[];for(a=a*c;a>63;)i.push((a&127)+128),a>>=7;i.push(a&63|(c==-1?192:128)),i[0]&=127,r.push(...i.reverse())}return Uint8Array.from(r)},M=(t,e=0,r)=>{r===void 0&&(r=1/0);let n=[],a=e,c=t.length,i=0,s=0;for(let o=t[e++];r>0&&e<c+1;o=t[e++])i===0?(i=(o&64)>0?-1:1,s=o&63):(s<<=7,s+=o&127),o>>7===0&&(n.push(s*i),r--,i=0,s=0);return e--,[n,e-a]};var _=t=>{if(t[2]==="c")return Uint8ClampedArray;switch(t=t[0]+t[1],t){case"u1":return Uint8Array;case"u2":return Uint16Array;case"u4":return Uint32Array;case"i1":return Int8Array;case"i2":return Int16Array;case"i4":return Int32Array;case"f4":return Float32Array;case"f8":return Float64Array;default:return console.error('an unrecognized typed array type `"${type}"` was provided'),Uint8Array}},K=()=>new Uint8Array(Uint32Array.of(1).buffer)[0]===1,l=K();var A=(t,e)=>{let r=t.byteLength,n=new Uint8Array(r),a=e;for(let c=0;c<a;c++){let i=a-1-c*2;for(let s=c;s<r+c;s+=a)n[s]=t[s+i]}return n},u=(...t)=>{let e=[0];for(let n of t)e.push(e[e.length-1]+n.length);let r=new Uint8Array(e.pop());for(let n of t)r.set(n,e.shift());return r};var P=new TextEncoder,F=new TextDecoder;var w=(...t)=>{let e=[];for(let r of t)e.push(h(...r));return u(...e)},k=(t,e,...r)=>{let n=[],a=0;for(let[c,...i]of r){let[s,o]=T(c,t,e+a,...i);n.push(s),a+=o}return[n,a]},h=(t,e,...r)=>{switch(t){case"bool":return Q(e);case"cstr":return Y(e);case"str":return j(e);case"bytes":return re(e);default:return t[1]==="v"?t.endsWith("[]")?x(e,t):U(e,t):t.endsWith("[]")?E(e,t):ne(e,t)}},T=(t,e,r,...n)=>{switch(t){case"bool":return X(e,r);case"cstr":return Z(e,r);case"str":return ee(e,r,...n);case"bytes":return te(e,r,...n);default:return t[1]==="v"?t.endsWith("[]")?v(e,r,t,...n):D(e,r,t):t.endsWith("[]")?R(e,r,t,...n):ae(e,r,t)}},Q=t=>Uint8Array.of(t?1:0),X=(t,e=0)=>[t[e]>=1,1],Y=t=>P.encode(t+"\0"),Z=(t,e=0)=>{let r=t.indexOf(0,e),n=t.subarray(e,r);return[F.decode(n),n.length+1]},j=t=>P.encode(t),ee=(t,e=0,r)=>{let n=r===void 0?void 0:e+r,a=t.subarray(e,n);return[F.decode(a),a.length]},re=t=>t,te=(t,e=0,r)=>{let n=r===void 0?void 0:e+r,a=t.slice(e,n);return[a,a.length]},E=(t,e)=>{let[r,n,a]=e,c=_(e),i=parseInt(n),s=!!(a==="l"&&l||a==="b"&&!l||i===1),o=c.from(t);if(o instanceof Uint8Array)return o;let d=new Uint8Array(o.buffer);return s?d:A(d,i)},R=(t,e=0,r,n)=>{let[a,c,i]=r,s=parseInt(c),o=!!(i==="l"&&l||i==="b"&&!l||s===1),d=n?s*n:void 0,m=t.slice(e,d?e+d:void 0),p=m.length,H=_(r),q=new H(o?m.buffer:A(m,s).buffer);return[Array.from(q),p]},ne=(t,e)=>E([t],e),ae=(t,e=0,r)=>{let[n,a]=R(t,e,r,1);return[n[0],a]};var N={},be=(t,e)=>t.encode(e),fe=(t,e,r)=>t.decode(e,r),f=t=>N[t.type].from(t),y=class{type;value;name;children;args=[];doc;constructor(e,r,n){this.type=e,e in N||this.setType(e,!0),r&&this.setValue(r),n&&this.setArgs(...n)}setType(e,r=!0){return this.type=e,r&&(N[e]=this.constructor),this}setName(e){return this.name=e,this}pushChildren(...e){return this.children===void 0&&(this.children=[]),this.children.push(...e),this}setValue(e){return this.value=e,this}setArgs(...e){return e&&(this.args=e),this}pushArgs(...e){return e&&(this.args===void 0&&(this.args=[]),this.args.push(e)),this}};C(y,"from",e=>{throw console.error("tried to create schema from `Object`: ",e),new Error("abstract `SchemaNode` class cannot create schema instances")});var b=class extends y{constructor(e,r,n){super(e,r,n)}static from(e){return new this(e.type,e.value,e.args)}encode(e,...r){return e===void 0&&(e=this.value),h(this.type,e,...r.length>0?r:this.args)}decode(e,r,...n){return T(this.type,e,r,...n.length>0?n:this.args)}},V=class extends y{children=[];constructor(...e){super("record"),e.length>0&&this.pushChildren(...e)}static from(e){let r=new this,n=e.children;for(let a of n)r.pushChildren(f(a).setName(a.name));return r}encode(e,...r){let n=[],a=r[0]||this.args[0]||0,c=r[1]||this.args[1]||this.children.length;for(let i=a;i<c;i++){let s=this.children[i];n.push(s.encode(e[s.name]))}return u(...n)}decode(e,r,...n){let a={},c=n[0]||this.args[0]||0,i=n[1]||this.args[1]||this.children.length,s=0;for(let o=c;o<i;o++){let d=this.children[o],[m,p]=d.decode(e,r+s);s+=p,a[d.name]=m}return[a,s]}},I=class extends y{children=[];constructor(){super("tuple")}static from(e){let r=new this,n=e.children;for(let a of n)r.pushChildren(f(a));return r}encode(e,...r){let n=[],a=this.children,c=r[0]||this.args[0]||0,i=r[1]||this.args[1]||this.children.length;for(let s=c;s<i;s++)n.push(a[s].encode(e[s]));return u(...n)}decode(e,r,...n){let a=[],c=this.children,i=n[0]||this.args[0]||0,s=n[1]||this.args[1]||this.children.length,o=0;for(let d=i;d<s;d++){let[m,p]=c[d].decode(e,r+o);o+=p,a.push(m)}return[a,o]}},g=class extends y{constructor(e,r){super("array"),e&&this.pushChildren(e),r&&this.setArgs(0,r)}static from(e){let r=e.children[0],n=e.args?e.args[0]:void 0;return new this(f(r),n)}encode(e,...r){let n=[],a=this.children[0],c=r[0]||this.args[0]||0,i=r[1]||this.args[1]||e.length;for(let s=c;s<i;s++)n.push(a.encode(e[s]));return u(...n)}decode(e,r,...n){let a=[],c=this.children[0],i=0,s=n[0]||this.args[0]||0,o=n[1]||this.args[1];o===void 0&&(o=s,s=0);for(let d=s;d<o;d++){let[m,p]=c.decode(e,r+i);i+=p,a[d]=m}return[a,i]}decodeNext(e,r,...n){return this.children[0].decode(e,r)}},S=class extends y{constructor(e,r){r instanceof Uint8Array||(r=Uint8Array.from(r)),super("enumentry",[e,r])}matchBytes(e,r,...n){let a=e.subarray(r),c=this.value[1],i=c.byteLength;for(let s=0;s<i;s++)if(a[s]!=c[s])return!1;return!0}matchValue(e,...r){let n=this.value[0];return e===n}encode(e,...r){return this.value[1]}decode(e,r,...n){return[this.value[0],this.value[1].byteLength]}},J=class extends y{default_schema=new S(void 0,new Uint8Array);constructor(...e){super("enum"),this.pushChildren(...e)}setDefault(e){return this.default_schema=e,this}getDefault(){return this.default_schema}encode(e,...r){for(let n of this.children)if(n.matchValue(e))return n.encode();return console.log(r),this.default_schema.encode(e,...r)}decode(e,r,...n){for(let a of this.children)if(a.matchBytes(e,r))return a.decode(e,r);return this.default_schema.decode(e,r,...n)}},z=class extends g{head_type;head_schema;constructor(e,r){super(r),this.setType("head_array"),this.head_type=e,this.head_schema=new b(e)}static from(e){let r=e.children[0];return new this(e.head_type,f(r))}encode(e){return u(this.head_schema.encode(e.length),super.encode(e))}decode(e,r){let[n,a]=this.head_schema.decode(e,r),[c,i]=super.decode(e,r+a,n);return[c,a+i]}},O=class extends y{head_schema;content_schema;constructor(e,r,n,a){super(`head_${r}`),this.head_schema=new b(e),this.content_schema=new b(r,n,a)}static from(e){let r=e.type.replace("head_","");return new this(e.head_type,r,e.value,e.args)}encode(e,...r){return u(this.head_schema.encode(e.length),this.content_schema.encode(e))}decode(e,r,...n){let[a,c]=this.head_schema.decode(e,r),[i,s]=this.content_schema.decode(e,r+c,a);return[i,c+s]}};})();
